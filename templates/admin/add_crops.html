<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Manage Crops</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-4">
  <h1 class="mb-4">Crop Management</h1>

  <!-- Display flash messages if any -->
  {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  {% endif %}

  <!-- Create Crop Button -->
  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#createCropModal">
    Add New Crop
  </button>
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary mb-3">Back</a>

  <!-- Crops Table -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Crop Name</th>
          <th>Price per Seedling</th>
          <th>Seedlings per Hectare</th>
          <th>Planting Interval</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for crop in crops %}
        <tr>
          <td>{{ crop.id }}</td>
          <td><strong>{{ crop.name }}</strong></td>
          <td>${{ "%.2f"|format(crop.price_per_seedling) }}</td>
          <td>{{ crop.seedlings_per_hectare }}</td>
          <td>{{ crop.planting_interval or 'N/A' }}</td>
          <td>
            <button class="btn btn-sm btn-info me-1" data-bs-toggle="modal" data-bs-target="#viewCropModal{{ crop.id }}">View</button>
            <button class="btn btn-sm btn-primary me-1" data-bs-toggle="modal" data-bs-target="#updateCropModal{{ crop.id }}">Edit</button>
            <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteCropModal{{ crop.id }}">Delete</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Create Crop Modal -->
<div class="modal fade" id="createCropModal" tabindex="-1" aria-labelledby="createCropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <form action="/admin/crops/create" method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createCropLabel">Add New Crop</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Basic Information -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Basic Information</h6>
            <div class="mb-3">
              <label class="form-label">Crop Name *</label>
              <input type="text" name="name" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Price per Seedling ($) *</label>
              <input type="number" name="price_per_seedling" class="form-control" required min="0" step="0.01">
            </div>
            <div class="mb-3">
              <label class="form-label">Seedlings per Hectare *</label>
              <input type="number" name="seedlings_per_hectare" class="form-control" required min="0" step="0.01">
            </div>
            <div class="mb-3">
              <label class="form-label">Planting Interval</label>
              <input type="text" name="planting_interval" class="form-control" placeholder="e.g., Every 3 months">
            </div>
          </div>
          
          <!-- Agricultural Inputs -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Agricultural Inputs</h6>
            <div class="mb-3">
              <label class="form-label">Weedicides</label>
              <input type="text" name="weedicides" class="form-control" placeholder="e.g., Glyphosate, 2,4-D">
            </div>
            <div class="mb-3">
              <label class="form-label">Pesticides</label>
              <input type="text" name="pesticides" class="form-control" placeholder="e.g., Imidacloprid, Cypermethrin">
            </div>
            <div class="mb-3">
              <label class="form-label">Fertilizers</label>
              <input type="text" name="fertilizers" class="form-control" placeholder="e.g., NPK 15-15-15, Urea">
            </div>
          </div>
        </div>
        
        <!-- Detailed Notes -->
        <div class="row">
          <div class="col-12">
            <h6 class="border-bottom pb-2 mb-3">Application Notes</h6>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Weedicides Notes</label>
              <textarea name="weedicides_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage..."></textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Pesticides Notes</label>
              <textarea name="pesticides_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage..."></textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Fertilizers Notes</label>
              <textarea name="fertilizers_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage..."></textarea>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Add Crop</button>
      </div>
    </form>
  </div>
</div>

<!-- Generate View, Update, and Delete modals for each crop -->
{% for crop in crops %}

<!-- View Crop Modal for Crop {{ crop.id }} -->
<div class="modal fade" id="viewCropModal{{ crop.id }}" tabindex="-1" aria-labelledby="viewCropLabel{{ crop.id }}" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewCropLabel{{ crop.id }}">Crop Details - {{ crop.name }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Basic Information -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Basic Information</h6>
            <div class="row mb-2">
              <div class="col-5"><strong>Crop ID:</strong></div>
              <div class="col-7">{{ crop.id }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-5"><strong>Name:</strong></div>
              <div class="col-7">{{ crop.name }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-5"><strong>Price per Seedling:</strong></div>
              <div class="col-7">${{ "%.2f"|format(crop.price_per_seedling) }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-5"><strong>Seedlings per Hectare:</strong></div>
              <div class="col-7">{{ crop.seedlings_per_hectare }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-5"><strong>Planting Interval:</strong></div>
              <div class="col-7">{{ crop.planting_interval or 'N/A' }}</div>
            </div>
          </div>
          
          <!-- Agricultural Inputs -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Agricultural Inputs</h6>
            <div class="row mb-2">
              <div class="col-4"><strong>Weedicides:</strong></div>
              <div class="col-8">{{ crop.weedicides or 'N/A' }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-4"><strong>Pesticides:</strong></div>
              <div class="col-8">{{ crop.pesticides or 'N/A' }}</div>
            </div>
            <div class="row mb-2">
              <div class="col-4"><strong>Fertilizers:</strong></div>
              <div class="col-8">{{ crop.fertilizers or 'N/A' }}</div>
            </div>
          </div>
        </div>
        
        <!-- Application Notes -->
        {% if crop.weedicides_notes or crop.pesticides_notes or crop.fertilizers_notes %}
        <div class="row mt-4">
          <div class="col-12">
            <h6 class="border-bottom pb-2 mb-3">Application Notes</h6>
          </div>
          {% if crop.weedicides_notes %}
          <div class="col-md-4">
            <div class="card mb-3">
              <div class="card-header bg-light">
                <strong>Weedicides Notes</strong>
              </div>
              <div class="card-body">
                <p class="card-text">{{ crop.weedicides_notes }}</p>
              </div>
            </div>
          </div>
          {% endif %}
          {% if crop.pesticides_notes %}
          <div class="col-md-4">
            <div class="card mb-3">
              <div class="card-header bg-light">
                <strong>Pesticides Notes</strong>
              </div>
              <div class="card-body">
                <p class="card-text">{{ crop.pesticides_notes }}</p>
              </div>
            </div>
          </div>
          {% endif %}
          {% if crop.fertilizers_notes %}
          <div class="col-md-4">
            <div class="card mb-3">
              <div class="card-header bg-light">
                <strong>Fertilizers Notes</strong>
              </div>
              <div class="card-body">
                <p class="card-text">{{ crop.fertilizers_notes }}</p>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Update Crop Modal for Crop {{ crop.id }} -->
<div class="modal fade" id="updateCropModal{{ crop.id }}" tabindex="-1" aria-labelledby="updateCropLabel{{ crop.id }}" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <form action="/admin/crops/edit/{{ crop.id }}" method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateCropLabel{{ crop.id }}">Update Crop - {{ crop.name }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <!-- Basic Information -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Basic Information</h6>
            <div class="mb-3">
              <label class="form-label">Crop Name *</label>
              <input type="text" name="name" class="form-control" value="{{ crop.name }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Price per Seedling ($) *</label>
              <input type="number" name="price_per_seedling" class="form-control" value="{{ crop.price_per_seedling }}" required min="0" step="0.01">
            </div>
            <div class="mb-3">
              <label class="form-label">Seedlings per Hectare *</label>
              <input type="number" name="seedlings_per_hectare" class="form-control" value="{{ crop.seedlings_per_hectare }}" required min="0" step="0.01">
            </div>
            <div class="mb-3">
              <label class="form-label">Planting Interval</label>
              <input type="text" name="planting_interval" class="form-control" value="{{ crop.planting_interval or '' }}" placeholder="e.g., Every 3 months">
            </div>
          </div>
          
          <!-- Agricultural Inputs -->
          <div class="col-md-6">
            <h6 class="border-bottom pb-2 mb-3">Agricultural Inputs</h6>
            <div class="mb-3">
              <label class="form-label">Weedicides</label>
              <input type="text" name="weedicides" class="form-control" value="{{ crop.weedicides or '' }}" placeholder="e.g., Glyphosate, 2,4-D">
            </div>
            <div class="mb-3">
              <label class="form-label">Pesticides</label>
              <input type="text" name="pesticides" class="form-control" value="{{ crop.pesticides or '' }}" placeholder="e.g., Imidacloprid, Cypermethrin">
            </div>
            <div class="mb-3">
              <label class="form-label">Fertilizers</label>
              <input type="text" name="fertilizers" class="form-control" value="{{ crop.fertilizers or '' }}" placeholder="e.g., NPK 15-15-15, Urea">
            </div>
          </div>
        </div>
        
        <!-- Detailed Notes -->
        <div class="row">
          <div class="col-12">
            <h6 class="border-bottom pb-2 mb-3">Application Notes</h6>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Weedicides Notes</label>
              <textarea name="weedicides_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage...">{{ crop.weedicides_notes or '' }}</textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Pesticides Notes</label>
              <textarea name="pesticides_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage...">{{ crop.pesticides_notes or '' }}</textarea>
            </div>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <label class="form-label">Fertilizers Notes</label>
              <textarea name="fertilizers_notes" class="form-control" rows="4" maxlength="1000" placeholder="Application instructions, timing, dosage...">{{ crop.fertilizers_notes or '' }}</textarea>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">Update Crop</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Crop Modal for Crop {{ crop.id }} -->
<div class="modal fade" id="deleteCropModal{{ crop.id }}" tabindex="-1" aria-labelledby="deleteCropLabel{{ crop.id }}" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteCropLabel{{ crop.id }}">Delete Crop</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <strong>Warning:</strong> This action cannot be undone!
        </div>
        <p>Are you sure you want to delete the following crop?</p>
        <div class="card">
          <div class="card-body">
            <h6 class="card-title">{{ crop.name }}</h6>
            <p class="card-text">
              <strong>ID:</strong> {{ crop.id }}<br>
              <strong>Price per Seedling:</strong> GHs{{ "%.2f"|format(crop.price_per_seedling) }}<br>
              <strong>Seedlings per Hectare:</strong> {{ crop.seedlings_per_hectare }}<br>
              <strong>Planting Interval:</strong> {{ crop.planting_interval or 'N/A' }}
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="/admin/crops/delete/{{ crop.id }}" class="btn btn-danger">Delete Crop</a>
      </div>
    </div>
  </div>
</div>

{% endfor %}

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>